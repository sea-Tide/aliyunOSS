## 1、注册OSS对象存储服务：https://oss.console.aliyun.com/

①、点击**bucket列表**，点击**创建bucket**，输入**bucket名称**后直接创建
②、创建**RAM子用户**：鼠标移动到**右上角的用户信息**，点击**AccessKey**，点击**使用RAM用户AccessKey**，点击**身份管理**，点击**用户**模块，点击**创建用户**，随便输入个名称，勾选**使用永久AccessKey访问**，确定后会看见**accessKeyId**和**accessKeySecret**，记录一下，后续要配置在yaml文件中，只会**出现这一次**(没记录要重新创建用户)
③、回到https://oss.console.aliyun.com/，点击**bucket列表**，点击**bucket名称**，点击**权限控制**模块，**阻止公网访问：关闭，读写权限：公共读**，**bucket授权策略：**点击**新增授权**，授权用户选择**子账号**，选完直接确定

## 2、( 可跳过 ) maven换源：提升依赖下载速度

在IDEA中点击**设置**，找到项目使用的**maven安装路径**：

## <img src="C:\Users\shihao\AppData\Roaming\Typora\typora-user-images\image-20251107190042587.png" alt="image-20251107190042587" style="zoom: 67%;" />

如果项目使用的是**包装器**就到C盘下的用户目录中找到**`.m2`**目录，这个路径中的**`wrapper`目录最深处**存放着**`maven`的安装目录**：<img src="C:\Users\shihao\AppData\Roaming\Typora\typora-user-images\image-20251107190254727.png" alt="image-20251107190254727" style="zoom:64%;" />

找到安装目录后，打开`conf`目录下的`settings.xml`文件，找到**`<mirrors></mirrors>`标签**添加以下配置进行**换源**，这里最后一个是默认自带的，官方自带的镜像下载依赖速度较慢，所以这里前两个配置中添加了阿里云镜像，配置后依赖下载**只走阿里云**，但依然要保留官方镜像用作**兜底**；由于我是使用`jitpack`制作的`maven`依赖，但换源后只会走阿里云镜像，所以这里单独配置了`jitpack`**不走阿里云镜像**(若用官方镜像，不换源则无需配置)：

```xml
  <mirrors>
  
     <!-- 阿里云 Maven Central 镜像 -->
    <mirror>
      <id>aliyunmaven</id>
      <mirrorOf>central,!jitpack.io</mirrorOf>
      <name>Aliyun Maven Central Mirror</name>
      <url>https://maven.aliyun.com/repository/central</url>
    </mirror>


    <!-- 阿里云公共仓库镜像（兼容 JCenter、Google 等）,唯独 jitpack 镜像不走阿里云 -->
    <mirror>
      <id>aliyun-public</id>
      <mirrorOf>*,!jitpack.io</mirrorOf> 
      <name>Aliyun Public Repository Group</name>
      <url>https://maven.aliyun.com/repository/public</url>
    </mirror>


    <!-- 官方自带 HTTP 阻止镜像，保持安全 -->
    <mirror>
      <id>maven-default-http-blocker</id>
      <mirrorOf>external:http:*</mirrorOf>
      <name>Pseudo repository to mirror external repositories initially using HTTP.</name>
      <url>http://0.0.0.0/</url>
      <blocked>true</blocked>
    </mirror>


  </mirrors>
```

## 3、引入依赖到`pom.xml`文件：

保持`<repositories>`标签和`<dependencies>`标签**同一层级**，注意：**使用该依赖，至少需把JDK升级到17版本，JDK17之前的版本无法使用**

```xml
	<repositories>
		<repository>
		    <id>jitpack.io</id>
		    <url>https://jitpack.io</url>
		</repository>
	</repositories>
```

```xml
	<dependency>
	    <groupId>com.github.sea-Tide</groupId>
	    <artifactId>aliyunOSS</artifactId>
	    <version>1.0.0</version>
	</dependency>
```

## 4、yaml文件中配置以下信息：

方式1：

```yaml
aliyun:
  oss:
    endpoint: https://oss-cn-hangzhou.aliyuncs.com  # 与我保持一致也可以，一般没修改都是默认hangzhou
    bucketName: your_bucket_name # 你创建的bucket名称
    accessKeyId: your_RAM_accessKeyId # 你RAM账号的accessKeyId
    accessKeySecret: your_RAM_accessKeySecret # 你RAM账号的accessKeySecret
```

方式2：
官方推荐把`accessKeyId`和`accessKeySecret`保存在**用户环境变量**中，再通过`yaml`文件引入环境变量**更加安全**：
<img src="C:\Users\shihao\AppData\Roaming\Typora\typora-user-images\image-20251107200351840.png" alt="image-20251107200351840" style="zoom: 67%;" />

```yaml
aliyun:
  oss:
    endpoint: https://oss-cn-hangzhou.aliyuncs.com # 与我保持一致也可以，一般没修改都是默认hangzhou
    bucketName: your_bucket_name # 你创建的bucket名称
    accessKeyId: ${OSS_ACCESS_KEY_ID} # 你RAM账号的accessKeyId
    accessKeySecret: ${OSS_ACCESS_KEY_SECRET} # 你RAM账号的accessKeySecret
```

## 5、具体使用方法：

在你的`controller`层中使用`@Autowired`注解依赖注入`AliOSSUtils`这个工具类，使其成为`IOC`外部容器的`bean`对象

```java
@Autowired
private AliOSSUtils aliOSSUtils;
```

把你前端页面发送`request`请求中携带的文件数据，在后端用`MultipartFile`对象来接收**（由于前端传递的是文件类型，所以前端不能使用默认的`form`表单提交的类型，默认是`application/x-www-form-urlencoded`或`application/json`，而现在应该改为：`multipart/form-data`作为`form`表单提交的类型）**，调用`upload`方法传递文件对象，该方法的返回值是一个`String`类型的`url`地址，直接把`url`返回给前端进行**数据回显**，前端即可展示图片

```java
	@PostMapping("/upload")
    public String upload(MultipartFile image) throws IOException {
        String url = aliOSSUtils.upload(image);
        return url;
    }
```